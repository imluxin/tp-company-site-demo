<?php
	/**
	 * 主题页面
	 *
	 * CT: 2014-09-23 12:00 by RTH
	 * UT: 2014-09-23 12:00 by RTH
	 */
 ?>
<import type='css' file="home.css.basic-information" />

<script type="text/javascript">
	var YM = {
		'setting_invite' : "{:U('setting_invite')}",
		'setting_examine': "{:U('setting_examine')}"
	};
</script>

<!-- 导入面包屑 -->
<?php
    $breadcrumbs = array(
        'base' => '基本信息',
        'list' => array(
            array('url'=>'', 'v'=>'基本信息')
        )
    );
?>
<include file="Public:_breadcrumbs" />

<div class="ymnaw">
    <ul class="nav nav-tabs ymbtn" role="tablist">
        <li role="presentation"><a href="<?php echo U('Org/info')?>">基本信息</a></li>
        <li role="presentation"><a href="<?php echo U('Org/authentication')?>">认证信息</a></li>
        <li role="presentation" class="active"><a href="<?php echo U('Org/invite')?>">邀请设置</a></li>
    </ul>
</div>

<div class="rightmain">
    <div class="table mt10 mb40">
        <table class="table">
            <tbody>
              
              <tr class="base-tr1">
                <td class="wh140">邀请注册</td>
                <td class="wh570 status-text"><eq name="info.reg_url" value="1">开启<else/>关闭</eq></td>
                <td class="wh78">
                    <a href="javascript:void(0);" data-state="<eq name="info.reg_url" value="1">1<else/>0</eq>" class="js-invite" width="500" height="330"><eq name="info.reg_url" value="1">关闭<else/>开启</eq></a>
                </td>
              </tr>
              <tr>
                <td class="wh140">注册审核</td>
                <td class="wh570 status-text"><eq name="info.reg_examine" value="1">开启<else/>关闭</eq></td>
                <td class="wh78">
                    <a href="javascript:void(0);" data-state="<eq name="info.reg_examine" value="1">1<else/>0</eq>" class="js-examine" width="500" height="330"><eq name="info.reg_examine" value="1">关闭<else/>开启</eq></a>
                </td>
              </tr>
              <tr>
                <td class="wh140">邀请链接</td>
                <td id="urlV" colspan="2"><?php echo $register_url; ?></td>
              </tr>
              <tr>
                <td class="wh140">邀请二维码</td>
                <td class="wh570">
					<a href="<?php echo U('Org/invite_qr'); ?>" target="_blank">
						<img src="<?php echo U('Org/invite_qr'); ?>" style="border:1px solid #ccc;" title="点击查看大图"/>
					</a>
				</td>
                <td class="wh78"></td>
              </tr>
            </tbody>
        </table>
    </div>
</div>

<script type="text/javascript">
	$(function(){
		$('.js-invite').click(function(){
			var obj = $(this);
			var status = $(this).attr('data-state');
			var data = {status:status};
			$.ajax({
				 url:YM['setting_invite'],
				 type:'POST',
				 data:data,
				 dataType:'json',
				 success:function(data){
					if(data.status == 'ok'){
						if(status == '1'){
							obj.attr('data-state','0');
							obj.parents('tr').find('.status-text').html('关闭');
							obj.html('开启');
						}else{
							obj.attr('data-state','1');
							obj.parents('tr').find('.status-text').html('开启');
							obj.html('关闭');
						}
					}else if(data.status == 'ko'){
						alert('设置失败，请重试');
					}
				 }
			 });
		})
		
		$('.js-examine').click(function(){
			var obj = $(this);
			var status = $(this).attr('data-state');
			var data = {status:status};
			$.ajax({
				 url:YM['setting_examine'],
				 type:'POST',
				 data:data,
				 dataType:'json',
				 success:function(data){
					if(data.status == 'ok'){
						if(status == '1'){
							obj.attr('data-state','0');
							obj.parents('tr').find('.status-text').html('关闭');
							obj.html('开启');
						}else{
							obj.attr('data-state','1');
							obj.parents('tr').find('.status-text').html('开启');
							obj.html('关闭');
						}
					}else if(data.status == 'ko'){
						alert('设置失败，请重试');
					}
				 }
			 });
		})
	})
</script>